# 트랜잭션 이해



## 목차

1. 트랜잭션 - 개념 이해
2. 데이터베이스 연결 구조와 DB 세션

------



## 1. 트랜잭션 - 개념 이해

- 트랜잭션을 이름 그대로 번역하면 거래라는 뜻이다.
- 데이터베이스에서 트랜잭션은 하나의 거래를 안전하게 처리하도록 보장해주는 것을 뜻한다.



### 5000원 계좌이체

1. A의 잔고를 5000원 감소
2. B의 잔고를 5000원 증가

- 계좌이체 거래는 2가지 작업이 합쳐져서 하나의 작업으로 동작해야 한다.
- 데이터베이스가 제공하는 트랜잭션 기능을 사용하면 1, 2작업 둘 다 함께 성공하고, 1, 2 작업 둘 다 함께 실패하는 것을 보장하낟.
- 모든 작업이 성공해서 데이터베이스에 정상 반영하는 것을 commit 이라 하고, 작업 중 하나라도 실패해서 거래 이전으로 되돌리는 것을 rollback이라 한다.



### 트랜잭션 ACID

- 트랜잭션은 ACID라 하는 원자성(Atomicity), 일관성(Consistency), 격리성(Isolation), 지속성(Durability)을 보장해야 한다.
- **원자성**: 트랜잭션 내에서 실행한 작업들은 마치 하나의 작업인 것처럼 모두 성공하거나 모두 실패해야 한다.
- **일관성**: 모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야 한다. (무결성 제약 조건을 항상 만족한다.)
- **격리성**: 동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리한다. (동시에 같은 데이터를 수정하지 못하도록 한다.)
- **지속성**: 트랜잭션을 성공적으로 마치면 그 결과는 항상 기록되어야 한다. 시스템에 문제가 발생해도 데이터베이스 로그 등을 사용해서 성공한 트랜잭션 내용을 복구해야 한다.



### 트랜잭션 격리 수준 - Isolation level

- 트랜잭션은 원자성, 일관성, 지속성을 보장한다. 문제는 격리성인데 트랜잭션 간에 격리성을 완벽히 보장하려면 트랜잭션을 거의 순서대로 실행해야 한다. 이렇게 하면 동시 처리 성능이 매우 나빠진다. 이런 문제로 인해 ANSI표준은 트랜잭션의 격리 수준을 4단계로 나누어 정의했다.
- READ UNCOMMITED
- READ COMMITED
- REPEATABLE READ
- SERIALIZATION



## 2. 데이터베이스 연결 구조와 DB 세션

- 트랜잭션을 더 자세히 이해하기 위해 데이터베이스 서버 연결 구조와 DB세션에 대해 알아보자.



### 데이터베이스 연결 구조

![데이터베이스_연결_구조.png](./img/데이터베이스_연결_구조.png)

- 클라이언트는 데이터베이스 서버에 연결을 요청하고 커넥션을 맺게 된다.
- 데이터베이스 서버는 내부에 세션이라는 것을 만든다. 앞으로 커넥션을 통한 모든 요청은 이 세션을 통해서 실행된다.
- 세션은 트랜잭션을 시작하고, 커밋 또는 롤백을 통해 트랜잭션을 종료한다.
- 사용자가 커넥션을 닫거나, 또는 DBA가 세션을 강제로 종료하면 세션이 종료된다.
- 커넥션 풀이 10개의 커넥션을 생성하면, 세션도 10개 만들어진다.